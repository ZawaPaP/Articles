---
title: Flaskを使って、sqlite3のデータをhtmlに表示させる方法
tags:
  - HTML
  - Flask
  - Bootstrap
  - SQLite3
private: false
updated_at: '2023-02-12T11:28:02+09:00'
id: 25706c6f306daf9e5660
organization_url_name: null
slide: false
ignorePublish: false
---
## tl;dr
* `Sqlite3`から`fetch`したデータは`tuple`型となっている
* `HTML`、`JavaScript`は`dict`や`tuple`といったデータ型を処理できないため、`list`にする必要がある


### Summary
flaskを使って`template`を`render`するときにデータの受け渡しをつまづいたのでメモ
PythonからHTMLにデータを送ることになりため、データ形式によっては`HTML`や`JavaScript`でうまく処理できないという問題が起こっていた。特にデータベースから`fetch`したデータは`tuple型`になっているがこれは`HTML`にはないデータ形式のため、送った後にHTML側で `{{ data.name }}`などとやってもうまく表示できなかった。

**解決法**
* データがdictの場合、keyword argumentsにして送る
    * 具体的には `render_template('index.html', **dict)`にすると、`dict{"A": 1}` が `dict("A" = 1)`となる。この型であれば処理が可能
* データをlist型にして送る。この場合`Sqlite3`であれば、`dict_factory`を使用してDBから取り出したデータを`dict`にしてから`listに入れるとうまくいった。

```python app.py
from flask import Flask, render_template
import products_get_data

@app.route("/", methods = ['GET', 'POST'])
def index():
    if request.method == "POST":
        return render_template("registration")
    
    products = products_get_data()
    return render_template('index.html', products=products)
```

```html index.html
<!DOCTYPE html>
...
<h4 class="card-title">{{ product.Name }}</h4>
```

#### データをlist型にして送る場合
```python get_data_from_db.py
def get_data():
    conn = sqlite3.connect('products.db', isolation_level=None)
    cursor = conn.cursor()
    sql = """SELECT * FROM products """
    cursor.execute(sql)
    
    data = []
    
    rows = cursor.fetchall()
    for row in rows:
        data.append(dict_factory(cursor, row))
    conn.close()
    return data

def dict_factory(cursor, row):
    fields = [column[0] for column in cursor.description]
    return {key: value for key, value in zip(fields, row)}
```

#### Last comment
もし誤りや、こうやるのがStandardという意見などあればいただけると嬉しいです。
